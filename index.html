<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surah Smasher</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e0f2fe; /* Light blue background */
            font-family: 'Inter', sans-serif;
            color: #1a237e;
        }
        canvas {
            display: block;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        #game-container {
            position: relative;
        }
        #message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2rem 3rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            white-space: pre-line;
        }
        #message-box h2 {
            font-size: 2.5rem;
            margin: 0 0 1rem 0;
            color: #1a237e;
        }
        #message-box p {
            font-size: 1.25rem;
            color: #4a4a4a;
        }
        .btn-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 50px;
            background-color: #64b5f6;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            min-width: 150px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 20px rgba(0, 0, 0, 0.15);
        }

        #pause-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            z-index: 50;
        }

        #pause-btn:hover {
            transform: scale(1.05);
        }

        #pause-btn svg {
            fill: #1a237e;
            width: 24px;
            height: 24px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <button id="pause-btn" style="display:none;">
            <svg viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
            </svg>
        </button>
        <div id="message-box">
            <h2 id="message-title">Find the Surahs Number</h2>
            <p id="message-content">Click the number that matches the Surah's order in the Quran.</p>
            <div class="btn-container">
                <button id="level1Btn" class="btn">Level 1</button>
                <button id="level2Btn" class="btn">Level 2</button>
                <button id="level3Btn" class="btn">Level 3</button>
                <button id="level4Btn" class="btn">Level 4</button>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // Get the canvas and its context
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const messageBox = document.getElementById('message-box');
            const messageTitle = document.getElementById('message-title');
            const messageContent = document.getElementById('message-content');
            const btnContainer = document.querySelector('.btn-container');
            const pauseBtn = document.getElementById('pause-btn');

            // Define game constants and variables
            const surahsLevel1 = [
                { name: "Al-Fatiha", number: 1 },
                { name: "Al-Baqarah", number: 2 },
                { name: "Ali-Imran", number: 3 },
                { name: "An-Nisa", number: 4 },
                { name: "Al-Ma'idah", number: 5 },
                { name: "Al-An'am", number: 6 },
                { name: "Al-A'raf", number: 7 },
                { name: "Al-Anfal", number: 8 },
                { name: "At-Tawbah", number: 9 },
                { name: "Yunus", number: 10 }
            ];
            
            const surahsLevel2 = [
                { name: "Hud", number: 11 },
                { name: "Yusuf", number: 12 },
                { name: "Ar-Ra'd", number: 13 },
                { name: "Ibrahim", number: 14 },
                { name: "Al-Hijr", number: 15 },
                { name: "An-Nahl", number: 16 },
                { name: "Al-Isra", number: 17 },
                { name: "Al-Kahf", number: 18 },
                { name: "Maryam", number: 19 },
                { name: "Ta-Ha", number: 20 }
            ];

            const surahsLevel3 = [
                { name: "Al-Anbiya", number: 21 },
                { name: "Al-Hajj", number: 22 },
                { name: "Al-Mu'minun", number: 23 },
                { name: "An-Nur", number: 24 },
                { name: "Al-Furqan", number: 25 },
                { name: "Ash-Shu'ara", number: 26 },
                { name: "An-Naml", number: 27 },
                { name: "Al-Qasas", number: 28 },
                { name: "Al-'Ankabut", number: 29 },
                { name: "Ar-Rum", number: 30 }
            ];

            const surahsLevel4 = [
                { name: "Luqman", number: 31 },
                { name: "As-Sajdah", number: 32 },
                { name: "Al-Ahzab", number: 33 },
                { name: "Saba", number: 34 },
                { name: "Fatir", number: 35 },
                { name: "Ya-Sin", number: 36 },
                { name: "As-Saffat", number: 37 },
                { name: "Sad", number: 38 },
                { name: "Az-Zumar", number: 39 },
                { name: "Ghafir", number: 40 }
            ];
            
            const allSurahLevels = [surahsLevel1, surahsLevel2, surahsLevel3, surahsLevel4];
            
            let bubbles = [];
            let particles = [];
            let currentLevelIndex = 0; // Use an index to track progress within a surah set
            let currentSurah = {};
            let isPaused = true;
            let audioContext;
            let gameAnimationFrameId = null;
            let currentSurahSet = [];

            // Define Bubble class for number objects
            class Bubble {
                constructor(x, y, radius, number, color) {
                    this.x = x;
                    this.y = y;
                    this.radius = radius;
                    this.number = number;
                    this.color = color;
                    this.vx = (Math.random() - 0.5) * 1.5; // Reduced speed for easier gameplay
                    this.vy = (Math.random() - 0.5) * 1.5; // Reduced speed for easier gameplay
                }

                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.15)';
                    ctx.shadowBlur = 10;
                    ctx.fill();
                    ctx.closePath();
                    ctx.shadowBlur = 0;

                    ctx.fillStyle = '#fff';
                    ctx.font = `bold ${this.radius * 0.7}px 'Inter', sans-serif`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(this.number, this.x, this.y);
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;

                    if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
                        this.vx *= -1;
                    }
                    if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
                        this.vy *= -1;
                    }
                }
            }
            
            // New class for the magical particles
            class Particle {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.radius = Math.random() * 2 + 1;
                    this.alpha = 1;
                    this.vx = (Math.random() - 0.5) * (Math.random() * 5 + 1);
                    this.vy = (Math.random() - 0.5) * (Math.random() * 5 + 1);
                    this.color = `hsl(${Math.random() * 360}, 70%, 70%)`;
                }

                draw() {
                    ctx.globalAlpha = this.alpha;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    ctx.closePath();
                    ctx.globalAlpha = 1; // Reset alpha
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.alpha -= 0.02; // Fade out over time
                }
            }

            // Function to show a message box
            function showMessage(title, content, buttonConfig) {
                isPaused = true;
                messageTitle.textContent = title;
                messageContent.textContent = content;

                // Hide the pause button when a message box is shown
                pauseBtn.style.display = 'none';

                // Clear existing buttons
                btnContainer.innerHTML = '';
                
                // Create buttons based on the config array
                buttonConfig.forEach(config => {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = config.text;
                    btn.onclick = config.action;
                    btnContainer.appendChild(btn);
                });

                messageBox.style.display = 'flex';
                if (gameAnimationFrameId) {
                    cancelAnimationFrame(gameAnimationFrameId);
                }
            }

            // Function to hide the message box
            function hideMessage() {
                isPaused = false;
                messageBox.style.display = 'none';
                pauseBtn.style.display = 'flex'; // Show the pause button when the game is not paused
                gameLoop();
            }

            // Function to generate a simple "pop" sound
            function createPopSound() {
                if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            }
            
            // Function to generate a simple "wrong" sound
            function createWrongSound() {
                if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.type = 'triangle';
                oscillator.frequency.value = 200;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            }

            // Function to draw the main game elements
            function draw() {
                // Clear the canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (currentSurah.name) {
                    // Draw the central "cute block" with the Surah name
                    const fontHeight = Math.min(canvas.width, canvas.height) * 0.05;
                    ctx.font = `bold ${fontHeight}px 'Inter', sans-serif`;
                    const textMetrics = ctx.measureText(currentSurah.name);
                    const textWidth = textMetrics.width;

                    const padding = canvas.width * 0.05;
                    const blockWidth = Math.max(textWidth + padding, canvas.width * 0.25);
                    const blockHeight = fontHeight * 2;
                    const blockX = (canvas.width - blockWidth) / 2;
                    const blockY = (canvas.height - blockHeight) / 2;
                    const cornerRadius = 20;

                    // Draw rounded rectangle
                    ctx.beginPath();
                    ctx.moveTo(blockX + cornerRadius, blockY);
                    ctx.lineTo(blockX + blockWidth - cornerRadius, blockY);
                    ctx.quadraticCurveTo(blockX + blockWidth, blockY, blockX + blockWidth, blockY + cornerRadius);
                    ctx.lineTo(blockX + blockWidth, blockY + blockHeight - cornerRadius);
                    ctx.quadraticCurveTo(blockX + blockWidth, blockY + blockHeight, blockX + blockWidth - cornerRadius, blockY + blockHeight);
                    ctx.lineTo(blockX + cornerRadius, blockY + blockHeight);
                    ctx.quadraticCurveTo(blockX, blockY + blockHeight, blockX, blockY + blockHeight - cornerRadius);
                    ctx.lineTo(blockX, blockY + cornerRadius);
                    ctx.quadraticCurveTo(blockX, blockY, blockX + cornerRadius, blockY);
                    ctx.closePath();

                    // Style the block
                    ctx.fillStyle = '#bbdefb'; /* Light blue block */
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                    ctx.shadowBlur = 15;
                    ctx.fill();
                    ctx.shadowBlur = 0;

                    // Draw the Surah text
                    ctx.fillStyle = '#1a237e'; /* Dark blue text */
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(currentSurah.name, canvas.width / 2, canvas.height / 2);
                }

                // Draw and update bubbles
                for (const bubble of bubbles) {
                    bubble.draw();
                }

                // Draw and update particles
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    particles[i].draw();
                    if (particles[i].alpha <= 0) {
                        particles.splice(i, 1);
                    }
                }
            }

            // Main game update loop
            function update() {
                // Update bubbles' positions
                for (const bubble of bubbles) {
                    bubble.update();
                }
            }

            // The main animation loop
            function gameLoop() {
                if (isPaused) return;
                update();
                draw();
                gameAnimationFrameId = requestAnimationFrame(gameLoop);
            }
            
            // Function to start the next surah within a level
            function nextSurah() {
                if (currentLevelIndex >= currentSurahSet.length) {
                    let levelNumber = allSurahLevels.indexOf(currentSurahSet) + 1;
                    const nextLevelSet = allSurahLevels[levelNumber];
                    
                    const buttonConfig = [
                        { text: `Replay Level ${levelNumber}`, action: () => startGame(currentSurahSet, 0) }
                    ];

                    if (nextLevelSet) {
                         buttonConfig.push({ text: `Go to Level ${levelNumber + 1}`, action: () => startGame(nextLevelSet, 0) });
                    }
                    buttonConfig.push({ text: 'Back to Menu', action: showLevelSelection });

                    showMessage(`Level ${levelNumber} Complete!`, "You've successfully learned this set of Surahs!", buttonConfig);
                    return;
                }
                
                currentSurah = currentSurahSet[currentLevelIndex];
                bubbles = [];

                const startNumber = currentSurahSet[0].number;
                const numbers = Array.from({ length: 10 }, (_, i) => startNumber + i);

                for (let i = numbers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
                }
                
                const bubbleRadius = Math.min(canvas.width, canvas.height) * 0.07;
                const bubbleColors = ['#ffab91', '#80cbc4', '#aed581', '#ffcdd2', '#c5e1a5', '#b39ddb', '#4db6ac'];
                for (let i = 0; i < numbers.length; i++) {
                    const number = numbers[i];
                    const x = Math.random() * (canvas.width - 2 * bubbleRadius) + bubbleRadius;
                    const y = Math.random() * (canvas.height - 2 * bubbleRadius) + bubbleRadius;
                    const color = bubbleColors[i % bubbleColors.length];
                    bubbles.push(new Bubble(x, y, bubbleRadius, number, color));
                }

                isPaused = false;
            }

            // Function to get the correct coordinates from a mouse or touch event
            function getCoords(event) {
                const rect = canvas.getBoundingClientRect();
                if (event.touches) {
                    return {
                        x: event.touches[0].clientX - rect.left,
                        y: event.touches[0].clientY - rect.top
                    };
                }
                return {
                    x: event.clientX - rect.left,
                    y: event.clientY - rect.top
                };
            }

            // Handle input (mouse click or touch)
            function handleInput(event) {
                if (isPaused) return;
                
                if (event.type === 'touchstart') {
                    event.preventDefault();
                }

                const coords = getCoords(event);
                const mouseX = coords.x;
                const mouseY = coords.y;

                for (const bubble of bubbles) {
                    const distance = Math.sqrt((mouseX - bubble.x) ** 2 + (mouseY - bubble.y) ** 2);
                    if (distance < bubble.radius + 10) { 
                        if (bubble.number === currentSurah.number) {
                            createPopSound();
                            for (let i = 0; i < 50; i++) {
                                particles.push(new Particle(bubble.x, bubble.y));
                            }
                            
                            currentLevelIndex++;
                            setTimeout(nextSurah, 500);
                        } else {
                            createWrongSound();
                        }
                        return;
                    }
                }
            }

            canvas.addEventListener('click', handleInput);
            canvas.addEventListener('touchstart', handleInput);

            // Handle window resize for responsiveness
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                draw();
            }

            // Function to start the game with a specific surah set and starting index
            function startGame(surahSet, startIndex) {
                hideMessage();
                resizeCanvas();
                currentSurahSet = surahSet;
                currentLevelIndex = startIndex;
                nextSurah();
                gameLoop();
            }

            // Function to show the level selection menu
            function showLevelSelection() {
                const buttons = [
                    { text: 'Level 1 (1-10)', action: () => startGame(surahsLevel1, 0) },
                    { text: 'Level 2 (11-20)', action: () => startGame(surahsLevel2, 0) },
                    { text: 'Level 3 (21-30)', action: () => startGame(surahsLevel3, 0) },
                    { text: 'Level 4 (31-40)', action: () => startGame(surahsLevel4, 0) }
                ];
                showMessage('Choose a Level', 'Select a Surah set to begin.', buttons);
            }

            // Show a pause menu when the pause button is clicked
            pauseBtn.addEventListener('click', () => {
                const buttons = [
                    { text: 'Keep Playing', action: hideMessage },
                    { text: 'Choose Level', action: showLevelSelection }
                ];
                showMessage('Game Paused', 'What would you like to do?', buttons);
            });

            // Initial call to show the level selection menu
            showLevelSelection();
            
            window.addEventListener('resize', resizeCanvas);
        };
    </script>
</body>
</html>
